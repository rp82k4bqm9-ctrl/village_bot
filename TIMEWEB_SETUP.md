# Подключение базы MySQL на Timeweb к приложению

Проект использует **одну базу MySQL на Timeweb**. Админ добавляет товары в админке — все пользователи видят один каталог.

---

## 1. Создание базы на Timeweb

1. Зайди в панель Timeweb → **Базы данных** (или **Базы данных MySQL**).
2. Нажми **Создать базу данных** (MySQL 8.0).
3. Укажи имя базы (например `ce382580_village`).
4. Запомни **логин** и **пароль** (логин часто совпадает с именем базы или аккаунта).

---

## 2. Строка подключения (DATABASE_URL)

Формат:

```text
mysql://ЛОГИН:ПАРОЛЬ@ХОСТ:3306/ИМЯ_БАЗЫ
```

- **ХОСТ** — сервер БД: `vh434.timeweb.ru` или IP вида `87.249.38.179` (из раздела «Доступ по FTP» или настроек базы).
- **Порт** — всегда **3306** (стандартный порт MySQL). Не подставляй IP в место порта.
- **ИМЯ_БАЗЫ** — имя базы (например `ce382580_village`).
- **ЛОГИН** и **ПАРОЛЬ** — из шага 1 (в панели иногда пишут: «Логин пользователя БД совпадает с названием БД» — тогда логин = имя базы).

Пример:

```text
mysql://ce382580:auditt2023@vh434.timeweb.ru:3306/ce382580_village
```

или с IP:

```text
mysql://ce382580:auditt2023@87.249.38.179:3306/ce382580_village
```

---

## 3. Точки доступа и где запускать API

В панели у базы по умолчанию только **localhost**. У Vercel нет одного фиксированного IP, поэтому «добавить IP Vercel» нельзя. Если в Timeweb **нет варианта «С любого адреса»**, удалённо подключаться к MySQL с Vercel не получится.

### Решение: API на Timeweb, фронт на Vercel

Запускай **API (Node-сервер) на том же Timeweb**, где база. Тогда подключение к MySQL идёт по **localhost** — добавлять точки доступа не нужно.

1. **На Timeweb** разверни Node-приложение (папка с `server.mjs`, либо хостинг Node по инструкции Timeweb).
2. В настройках этого приложения на Timeweb задай переменные:
   - `DATABASE_URL` = `mysql://ЛОГИН:ПАРОЛЬ@localhost:3306/ИМЯ_БАЗЫ` (именно **localhost** — БД на том же сервере).
   - `ADMIN_TOKEN` = свой секретный токен.
3. Узнай URL твоего сайта/API на Timeweb (например `https://ваш-сайт.timeweb.ru`).
4. **Фронт** оставь на Vercel. Чтобы он ходил в API на Timeweb:
   - В Vercel → проект → **Settings** → **Environment Variables** добавь переменную **`VITE_API_URL`** = `https://ваш-сайт.timeweb.ru` (без слэша в конце).
   - Пересобери и задеплой проект на Vercel.
5. Точки доступа к базе в панели Timeweb **не трогай** — достаточно localhost.

Итог: база и API на Timeweb (подключение по localhost), фронт на Vercel обращается к API по `VITE_API_URL`. Вариант «с любого адреса» не нужен.

---

## 4. Инициализация таблиц

Выполни SQL из файла **`database.sql`** в корне проекта:

- через **phpMyAdmin** на Timeweb: выбери базу → вкладка **SQL** → вставь содержимое `database.sql` → выполнить;
- или через консоль: `mysql -h ХОСТ -P 3306 -u ЛОГИН -p ИМЯ_БАЗЫ < database.sql`.

---

## 5. Переменные окружения

**Если API на Timeweb** (рекомендуется, если нет «с любого адреса»):

- В настройках **Node-приложения на Timeweb**: `DATABASE_URL` = `mysql://...@localhost:3306/...`, `ADMIN_TOKEN`.
- На **Vercel** (для фронта): только `VITE_API_URL` = `https://ваш-сайт.timeweb.ru`.

**Если API на Vercel** (и в Timeweb есть «С любого адреса»):

- На Vercel: `DATABASE_URL` (строка из шага 2 с хостом Timeweb и портом 3306), `ADMIN_TOKEN`.  
- `VITE_API_URL` не задавай — фронт будет ходить на тот же домен (Vercel).

---

## 6. Проверка

- Открой приложение (каталог и админку).
- В админке добавь/измени товар — он должен появиться в каталоге у всех пользователей (один источник данных — база на Timeweb).

---

## Итог

- БД — **только на Timeweb** (MySQL).
- Строка подключения — **хост:3306**, не хост:IP.
- **Если нет «с любого адреса»** — ставь API на Timeweb с `DATABASE_URL` на **localhost**, фронт на Vercel с `VITE_API_URL` на твой домен Timeweb. Точки доступа не настраивай.
- Лишних привязок к другим БД в проекте нет.
