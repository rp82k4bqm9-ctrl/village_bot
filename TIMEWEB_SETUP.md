# Подключение базы MySQL на Timeweb к приложению

Проект использует **одну базу MySQL на Timeweb**. Админ добавляет товары в админке — все пользователи видят один каталог.

---

## 1. Создание базы на Timeweb

1. Зайди в панель Timeweb → **Базы данных** (или **Базы данных MySQL**).
2. Нажми **Создать базу данных** (MySQL 8.0).
3. Укажи имя базы (например `ce382580_village`).
4. Запомни **логин** и **пароль** (логин часто совпадает с именем базы или аккаунта).

---

## 2. Строка подключения (DATABASE_URL)

Формат:

```text
mysql://ЛОГИН:ПАРОЛЬ@ХОСТ:3306/ИМЯ_БАЗЫ
```

- **ХОСТ** — сервер БД: `vh434.timeweb.ru` или IP вида `87.249.38.179` (из раздела «Доступ по FTP» или настроек базы).
- **Порт** — всегда **3306** (стандартный порт MySQL). Не подставляй IP в место порта.
- **ИМЯ_БАЗЫ** — имя базы (например `ce382580_village`).
- **ЛОГИН** и **ПАРОЛЬ** — из шага 1 (в панели иногда пишут: «Логин пользователя БД совпадает с названием БД» — тогда логин = имя базы).

Пример:

```text
mysql://ce382580:auditt2023@vh434.timeweb.ru:3306/ce382580_village
```

или с IP:

```text
mysql://ce382580:auditt2023@87.249.38.179:3306/ce382580_village
```

---

## 3. Точки доступа (если API на Vercel)

В панели у базы по умолчанию только **localhost**. Если API крутится на **Vercel** (или другом сервере), нужно разрешить удалённый доступ:

1. В разделе базы на Timeweb найди **«Точки доступа к базе данных»**.
2. Нажми **«+ Добавить доступ»**.
3. Добавь точку доступа так, как предлагает Timeweb:
   - либо **«С любого адреса»** / **«Любой хост»** (если есть),
   - либо укажи хост/IP, с которого идёт запрос (у Vercel нет одного фиксированного IP — подойдёт только вариант «с любого адреса», если он есть).

Без добавленной точки доступа подключение с Vercel к MySQL на Timeweb не заработает.

---

## 4. Инициализация таблиц

Выполни SQL из файла **`database.sql`** в корне проекта:

- через **phpMyAdmin** на Timeweb: выбери базу → вкладка **SQL** → вставь содержимое `database.sql` → выполнить;
- или через консоль: `mysql -h ХОСТ -P 3306 -u ЛОГИН -p ИМЯ_БАЗЫ < database.sql`.

---

## 5. Переменные окружения (Vercel)

1. Vercel → твой проект → **Settings** → **Environment Variables**.
2. Добавь:

| Имя            | Значение                                      |
|----------------|-----------------------------------------------|
| `DATABASE_URL` | Строка из шага 2 (например с портом 3306)   |
| `ADMIN_TOKEN`  | Секретный токен админки (например свой ключ) |

3. Сохрани и сделай **Redeploy**.

---

## 6. Проверка

- Открой приложение (каталог и админку).
- В админке добавь/измени товар — он должен появиться в каталоге у всех пользователей (один источник данных — база на Timeweb).

---

## Итог

- БД — **только на Timeweb** (MySQL).
- Строка подключения — **хост:3306**, не хост:IP.
- Для доступа с Vercel — в Timeweb обязательно **«+ Добавить доступ»** (удалённый доступ).
- Лишних привязок к другим БД в проекте нет.
